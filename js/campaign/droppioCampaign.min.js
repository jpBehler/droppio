$(document).ready(function(){function t(){this.bloodType=!1,this.nearbyHospitals=!1}function o(t){return("0"+t.toString(16)).substr(-2)}function a(t){var a=new Uint8Array((t||40)/2);return window.crypto.getRandomValues(a),Array.from(a,o).join("")}var e=new Campaigns,n=(new t,!1),s={4:[4,8],1:[1,5,4,8],2:[2,6,4,8],3:[1,5,3,7,2,6,4,8],8:[8],5:[5,8],6:[6,8],7:[7,5,6,8]};$.post("/",{_xsrf:function(t){var o=document.cookie.match("\\b"+t+"=([^;]*)\\b");return!!o&&o[1]}("_xsrf"),type:"creds"}).done(function(t){if(t=JSON.parse(t),respType=t.type,"creds"==respType){var o=t.dbUser,a=t.dbPass,e=new PouchDB("settings"+o,{auto_compaction:!1,cache:!1,heartbeat:!0}),s=new PouchDB("https://"+o+":"+a+"@droppio.org:6489/settings"+o),e=new PouchDB("campaigns",{auto_compaction:!1,cache:!1,heartbeat:!0}),s=new PouchDB("https://"+o+":"+a+"@droppio.org:6489/campaigns");e.sync(s,{live:!0,retry:!0,back_off_function:function(t){return 0==t?1e3:t>=1e3&&t<18e5?1.5*t:t>=18e5?1.1*t:void 0}}).on("paused",function(t){n=!0}).on("error",function(t){})}}),$(".datepicker").datepicker({selectMonths:!0,selectYears:15,today:"Today",clear:"Clear",close:"Ok",closeOnSelect:!1}),$(".timepicker").timepicker({defaultTime:"08:00",autoClose:!0,twelvehour:!1,done:"OK",cancel:"Cancelar"}),$("select").formSelect(),$("#submitCampaign").submit(function(){n&&(name=$("#name").val(),lastname=$("#lastname").val(),bloodType=$("#bloodType").val(),dni=$("#dni").val(),status=$("#status").val(),hospital=$("#hospital").val().split("@"),hospitalLocation=hospital[1].split(" "),hospitalLocation={lat:hospitalLocation[0],lon:hospitalLocation[1]},hospital=hospital[0],hospitalStarts=$("#hospitalHoursStart").val(),hospitalEnds=$("#hospitalHoursEnd").val(),hospitalHours=hospitalStarts+" "+hospitalEnds,e.name=name,e.lastname=lastname,e.bloodType=bloodType,e.dni=dni,e.status=status,e.hospital=hospital,e.hospitalHours=hospitalHours,e.createdAt=moment().tz("America/Argentina/Buenos_Aires").valueOf(),e._id=dbUser+a(16),e.compatible=s[e.bloodType],campaignsDB.find({selector:{dni:e.dni}}).then(function(t){console.log(t)}))})});