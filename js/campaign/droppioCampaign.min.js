$(document).ready(function(){function n(n){return("0"+n.toString(16)).substr(-2)}function t(t){var e=new Uint8Array((t||40)/2);return window.crypto.getRandomValues(e),Array.from(e,n).join("")}e={_id:!1,bloodType:!1,name:!1,lastname:!1,dni:!1,hospital:!1,hospitalHours:!1,status:!1,createdAt:!1},$.fn.extend({animateCss:function(n,t){var e=function(n){var t={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"mozAnimationEnd",WebkitAnimation:"webkitAnimationEnd"};for(var e in t)if(void 0!==n.style[e])return t[e]}(document.createElement("div"));return this.addClass("animated "+n).one(e,function(){$(this).removeClass("animated "+n),"function"==typeof t&&t()}),this}});var e=new Campaign,o={campaigns:!0,settings:!0,hospitals:!1},a={selector:{province:{$exists:!0}}},i={4:[4,8],1:[1,5,4,8],2:[2,6,4,8],3:[1,5,3,7,2,6,4,8],8:[8],5:[5,8],6:[6,8],7:[7,5,6,8]};$.post("/registerTest",{_xsrf:function(n){var t=document.cookie.match("\\b"+n+"=([^;]*)\\b");return!!t&&t[1]}("_xsrf"),type:"creds"}).done(function(n){if(n=JSON.parse(n),respType=n.type,"creds"==respType){var s=n.dbUser,c=n.dbPass,r=new PouchDB("settings"+s,{auto_compaction:!1,cache:!1,heartbeat:!0}),l=new PouchDB("https://"+s+":"+c+"@alfredarg.com:6489/settings"+s),u=new PouchDB("campaigns",{auto_compaction:!0,cache:!1,heartbeat:!0}),d=new PouchDB("https://"+s+":"+c+"@alfredarg.com:6489/campaigns"),p=new PouchDB("hospitals",{auto_compaction:!1,cache:!1,heartbeat:!0}),m=new PouchDB("https://"+s+":"+c+"@alfredarg.com:6489/hospitals");r.sync(l,{live:!0,retry:!0,back_off_function:function(n){return 0==n?1e3:n>=1e3&&n<18e5?1.5*n:n>=18e5?1.1*n:void 0}}).on("paused",function(n){if(o.settings){var t=["name","lastName","bloodType","dni"],e=[];r.allDocs({include_docs:!0,keys:t}).then(function(n){n.rows.forEach(function(n){t.includes(n.id)&&e.push(n.id),"province"==n.id&&(a.selector={province:n.value})}),p.find(a).then(function(n){var t="docs"in n&&n.docs;if(t)for(var e in t)doc=t[e],name=doc.name,$("#hospital").append('<option value="'+name+'">'+name+"</option>");$("#hospital").formSelect()})}),$("#ownCampaign, #othersCampaign").click(function(){t.forEach(function(n){$("#"+n+"Div").css("display","block"),$("#"+n+"Div").animateCss("flipInX")}),"ownCampaign"==$(this).attr("id")&&r.allDocs({include_docs:!0,keys:t}).then(function(n){for(var t in e)$("#"+t+"Div").animateCss("flipOutX",function(){$("#"+t+"Div").css("display","none")})}).catch(function(n){})}),o.settings=!1}}).on("error",function(n){}),p.sync(m,{live:!0,retry:!0,back_off_function:function(n){return 0==n?1e3:n>=1e3&&n<18e5?1.5*n:n>=18e5?1.1*n:void 0}}).on("paused",function(n){}),u.sync(d,{live:!0,retry:!0,back_off_function:function(n){return 0==n?1e3:n>=1e3&&n<18e5?1.5*n:n>=18e5?1.1*n:void 0}}).on("paused",function(n){o.campaigns&&$("#createCampaign").submit(function(n){n.preventDefault(),name=$("#name").val(),lastname=$("#lastname").val(),bloodType=$("#bloodType").val(),dni=$("#dni").val(),status=$("#status").val(),hospital=$("#hospital").val(),hospitalStarts=$("#hospitalHoursStart").val(),hospitalEnds=$("#hospitalHoursEnd").val(),hospitalHours=hospitalStarts+" "+hospitalEnds,e.name=name,e.lastname=lastname,e.bloodType=bloodType,e.dni=dni,e.status=status,e.hospital=hospital,e.hospitalHours=hospitalHours,e.createdAt=moment().tz("America/Argentina/Buenos_Aires").valueOf(),e._id=s+t(16),e.compatible=i[e.bloodType],console.log(e),u.put(e).then(function(n){console.log("Alles gut!"),console.log(n),doc=!!n.docs.length&&n.docs[0],doc}).catch(function(n){})}),o.campaigns=!1}).on("error",function(n){})}}),$("#bloodType, #status").formSelect(),$(".datepicker").datepicker({selectMonths:!0,selectYears:15,today:"Today",clear:"Clear",close:"Ok",closeOnSelect:!1}),$(".timepicker").timepicker({defaultTime:"08:00",autoClose:!0,twelvehour:!1,done:"OK",cancel:"Cancelar"})});