$(document).ready(function(){function e(){this.bloodType=!1,this.radius=!1}var t={4:"O+",1:"A+",2:"B+",3:"AB+",8:"O-",5:"A-",6:"B-",7:"AB-"},o={campaigns:!0},a=new e;$.post("/registerTest",{_xsrf:xsrf_token,type:"creds"}).done(function(e){if(e=JSON.parse(e),respType=e.type,"creds"==respType){dbUser=e.dbUser,dbPass=e.dbPass,dbAdminUser=e.dbAdminUser,dbAdminPass=e.dbAdminPass;var n=new PouchDB("campaigns",{auto_compaction:!1,cache:!1,heartbeat:!0}),i=new PouchDB("https://"+dbAdminUser+":"+dbAdminPass+"@alfredarg.com:6489/campaigns"),r=new PouchDB("settings"+dbUser,{auto_compaction:!1,cache:!1,heartbeat:!0}),s=new PouchDB("https://"+dbUser+":"+dbPass+"@alfredarg.com:6489/settings"+dbUser),c=new PouchDB("stats"+dbUser,{auto_compaction:!1,cache:!1,heartbeat:!0}),l=new PouchDB("https://"+dbAdminUser+":"+dbAdminPass+"@alfredarg.com:6489/stats"+dbUser),d=new PouchDB("algorithms",{auto_compaction:!1,cache:!1,heartbeat:!0}),m=new PouchDB("https://"+dbAdminUser+":"+dbAdminPass+"@alfredarg.com:6489/algorithms");r.sync(s,{live:!0,retry:!0,back_off_function:function(e){return 0==e?1e3:e>=1e3&&e<18e5?1.5*e:e>=18e5?1.1*e:void 0}}).on("paused",function(e){var s=["bloodType","nearbyHospitals"];r.allDocs({include_docs:!0,keys:s}).then(function(e){var r=!0;e.rows.forEach(function(e){"error"in e||null===e.doc?r=!1:a[e.doc._id]=e.doc.value}),r&&o.campaigns&&n.replicate.from(i,{live:!0,retry:!0,back_off_function:function(e){return 0==e?1e3:e>=1e3&&e<18e5?1.5*e:e>=18e5?1.1*e:void 0},filter:function(e,t){var o=e.compatible.includes(t.query.bloodType),a=t.query.nearbyHospitals.includes(e.hospital),n=e.createdAt>t.query.expiry;return o&&a&&n},query_params:{bloodType:a.bloodType,nearbyHospitals:a.nearbyHospitals,expiry:moment().tz("America/Argentina/Buenos_Aires").subtract(30,"days").valueOf()}}).on("change",function(e){alert(JSON.stringify(doc)),docs=e.docs,docs.rows.forEach(function(e){receiver=e.name+" "+e.lastname,hospital=e.hospital,compatible="",e.compatible.forEach(function(e){compatible+=t[e]+" "}),$("#casperCampaign").find("#campaignReceiver").html(receiver),$("#casperCampaign").find("#campaignHospital").html(hospital),$("#casperCampaign").find("#campaignCompatibility").html(compatible),$("#casperCampaign").css("display","block")})})}).catch(function(e){console.log("Aha something nasty happened while syncing campaigns!")})}).on("error",function(e){console.log("Oops smth happened while trying to sync settings!")}),c.sync(l,{live:!0,retry:!0,back_off_function:function(e){return 0==e?1e3:e>=1e3&&e<18e5?1.5*e:e>=18e5?1.1*e:void 0}}).on("error",function(e){}),d.sync(m,{live:!0,retry:!0,back_off_function:function(e){return 0==e?1e3:e>=1e3&&e<18e5?1.5*e:e>=18e5?1.1*e:void 0}}).on("error",function(e){})}}),$("#home").click(function(e){e.preventDefault(),window.location="https://droppio.org/home"}),$("#campaign").click(function(e){e.preventDefault(),window.location="https://droppio.org/campaign"}),$("#profile").click(function(e){e.preventDefault(),window.location="https://droppio.org/profile"}),$(".datepicker").datepicker({selectMonths:!0,selectYears:!0,min:[1901,1,1],max:!0,Year:2002,selectYears:1e3,labelMonthNext:"Proximo Mes",labelMonthPrev:"Mes Anterior",labelMonthSelect:"Seleccione Mes",labelYearSelect:"Seleccione Año",monthsFull:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],monthsShort:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],weekdaysFull:["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sabado"],weekdaysShort:["Dom","Lun","Mar","Mie","Jue","Vie","Sab"],weekdaysLetter:["D","L","M","M","J","V","S"],today:!1,clear:"Borrar",close:"Cerrar"}),$(".timepicker").timepicker({default:!1,fromnow:0,twelvehour:!0,donetext:"OK",cleartext:"Borrar",canceltext:"Cancelar",autoclose:!0,ampmclickable:!0,aftershow:function(){}}),$("select").formSelect(),$(".spread").click(function(e){swal("Gracias!","Ademas de compartir puedes salvar a esta persona donando!.","success")}),$(".donate").click(function(e){swal({html:'<div class="row center"><div class="col s2 m2 l2"> <i class="fas fa-exclamation-circle ce" style="margin-top:0.5em; margin-left:-0.25em; font-size:2.5em; color:#c91249"></i></div><div class="col s10 m10 l10"><p class="left flow-text" style="text-align:left;color:#c91249">Tenga en cuenta que para donar usted debe:</p></div></div><div class="row" style="margin-top:-1em; text-align:left"><div class="col s2 m2 l2" style="margin-top:-1em"></div><div class="col s10 m10 l10"><ul><li style="margin-bottom:0.5em"> &bull; Pesar más de 50 kilos</li><li style="margin-bottom:0.5em"> &bull; Tener entre 18 y 65 años de edad</li><li style="margin-bottom:0.5em"> &bull; No haber padecido una enfermedad en los ultimos 7 días</li><li style="margin-bottom:0.5em"> &bull; Tener presión arterial normal</li><li style="margin-bottom:0.5em"> &bull; No habese hecho un tatuaje ni haber recibido alguna operacion en el ultimo año</li></ul></div></div></div></div><div class="row center"><div class="col s2 m2 l2"> <i class="fas fa-h-square" style="margin-top:0.5em; margin-left:-0.25em; font-size:2.5em; color:#c91249;"></i></div><div class="col s10 m10 l10"><p class="left flow-text" style="text-align:left; color:#c91249;">Presentarse en Hospital Español<span style="color:black;"> de 8hs a 12hs</span></p></div></div>',showCancelButton:!0,confirmButtonText:"Confirmar",confirmButtonColor:"#ffab40",cancelButtonText:"Cancelar",position:"top-center"}).then(function(e){e.value?(id=$(this).attr("id"),donation={_id:info._id+"@"+id,name:info.name,lastName:info.LastName},settingsDB.get("isAble").then(function(e){campaigns.put(donation).catch(function(e){swal({title:"Oops!",text:"Ocurrió un error al procesar la donación, por favor intente nuevamente :)",type:"error",showConfirmButton:!1})})}).catch(function(e){months={January:"01",February:"02",March:"03",April:"04",May:"05",June:"06",July:"07",August:"08",September:"09",October:"10",November:"11",December:"12"},now=moment().tz("America/Argentina/Buenos_Aires"),birth=info.birthDate.split(" "),day=parseInt(birth[0])<10?"0"+birth[0]:birth[0],month=months[birth[1].split(",")[0]],year=birth[2],age=moment(year+"-"+day+"-"+month+" 00:00").diff(now,"years"),weight=parseInt(info.weight),age>=18&&weight>=50&&(settingsDB.put({_id:"_local/isAble"}),campaigns.put(donation).catch(function(e){swal({title:"Oops!",text:"Ocurrió un error al procesar la donación, por favor intente nuevamente :)",type:"error",showConfirmButton:!1})}))}),swal({title:"Genial!",text:"Estás a un paso de salvar a esta persona, sólo debes ir a donar",type:"success",confirmButtonText:"Ir a donar",showCancelButton:!0,cancelButtonText:"Iré luego"}).then(function(e){console.log("Button value: "+e.value),e.value&&(window.location="https://www.google.com/maps?&z=10&mrt=yp&t=m&q=-32.8996453,-68.878869,13")})):(e.dismiss,swal.DismissReason.cancel)})}),$("#spread").click(function(){"undefined"!=typeof FB&&null!==FB&&FB.login(function(e){e.status},{scope:"publish_actions"})})});