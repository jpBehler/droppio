$(document).ready(function(){function e(){this._jsonified=[],this._keys=[],this.bloodType=null,this.name=null,this.lastname=null,this.dni=null,this.email=null,this.weight=null,this.birthDate=null,this.password=null,this.province=null,this.toJSON=function(){for(var e in this)null!=this[e]&&-1==e.indexOf("_")&&(this._jsonified[e]=this[e]);return this._jsonified}}function o(e){t.location={lat:e.coords.latitude,lon:e.coords.longitude}}function n(){var e=new google.maps.Geocoder,o=new google.maps.LatLng(t.location.lat,t.location.lon);e.geocode({latLng:o},function(e,o){if(o==google.maps.GeocoderStatus.OK){var n;n=e.length>1?e[1]:e[0],t.province=n.address_components[3].long_name}})}var t=new e;navigator.geolocation.watchPosition(function(e){o(e),t.province&&n()}),$.post("/registerTest",{_xsrf:xsrf_token,type:"creds"}).done(function(e){if(e=JSON.parse(e),respType=e.type,"creds"==respType){var o=e.dbUser,n=e.dbPass,i=new PouchDB("settings"+o,{auto_compaction:!0,cache:!1,heartbeat:!0}),s=new PouchDB("https://"+o+":"+n+"@alfredarg.com:6489/settings"+o),c=new PouchDB("hospitals",{auto_compaction:!0,cache:!1,heartbeat:!0}),a=new PouchDB("https://"+o+":"+n+"@alfredarg.com:6489/hospitals");$("#saveSettings").submit(function(e){e.preventDefault(),t.name=$("#name").val(),t.lastname=$("#lastname").val(),t.bloodType=$("#bloodType").val(),t.dni=$("#dni").val(),t.email=$("#email").val(),t.birthDate=$("#birthDate").val(),t.weight=$("#weight").val(),t.password=$("#password").val(),t.radius=$("#radius").val(),elems=t.toJSON(),keys=Object.keys(elems),console.log(elems),"province"in elems&&c.find({selector:{province:t.province}}).then(function(e){console.log(e)}).catch(function(e){console.log(e)}),i.allDocs({include_docs:!0,keys:keys}).then(function(e){e.rows.forEach(function(e){"error"in e?i.put({_id:e.key,value:elems[e.key]}).catch(function(e){}):(doc=e.doc,doc.value=elems[e.key],console.log(doc),i.put(doc).catch(function(e){}))})}).catch(function(e){})}),i.sync(s,{live:!0,retry:!0,back_off_function:function(e){return 0==e?1e3:e>=1e3&&e<18e5?1.5*e:e>=18e5?1.1*e:void 0}}).on("error",function(e){}),c.sync(a,{live:!0,retry:!0,back_off_function:function(e){return 0==e?1e3:e>=1e3&&e<18e5?1.5*e:e>=18e5?1.1*e:void 0}}).on("error",function(e){})}}),$(".datepicker").datepicker({selectMonths:!0,selectYears:15,today:"Today",clear:"Clear",close:"Ok",closeOnSelect:void 0}),$("select").formSelect()});